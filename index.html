// تأكد من وضع هذا الجزء في نهاية الـ Script في ملف index.html
window.onload = function() {
    
    // ربط زر الشحن
    const chargeBtn = document.getElementById('chargeBtn');
    if(chargeBtn) {
        chargeBtn.onclick = async function() {
            const amt = document.getElementById('chargeAmount').value;
            const code = document.getElementById('transferCode').value;
            if(!amt || !code) return alert("أكمل البيانات");

            this.disabled = true;
            this.innerText = "جاري الإرسال...";

            try {
                const res = await fetch('https://army-bot-3y9o.onrender.com/send_order', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    mode: 'cors',
                    body: JSON.stringify({
                        type: 'شحن رصيد',
                        user_name: userData.name,
                        acc_code: userData.accountCode,
                        details: {"المبلغ": amt, "كود_التحويل": code}
                    })
                });
                if(res.ok) alert("✅ تم الإرسال للمراجعة");
                else alert("❌ خطأ من السيرفر: " + res.status);
            } catch (e) {
                console.error(e);
                alert("⚠️ فشل الاتصال بالسيرفر! تأكد أن سيرفر Render يعمل.");
            } finally {
                this.disabled = false;
                this.innerText = "إرسال للمراجعة";
                document.getElementById('rechargeModal').style.display = 'none';
            }
        };
    }

    // ربط زر الطلب
    const orderBtn = document.getElementById('orderBtn');
    if(orderBtn) {
        orderBtn.onclick = async function() {
            const price = parseFloat(document.getElementById('totalPrice').innerText);
            if(userData.balance < price) return alert("رصيدك غير كافٍ");

            this.disabled = true;
            try {
                const res = await fetch('https://army-bot-3y9o.onrender.com/send_order', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    mode: 'cors',
                    body: JSON.stringify({
                        type: 'طلب رشق',
                        user_name: userData.name,
                        acc_code: userData.accountCode,
                        details: {
                            "المنصة": document.getElementById('platform').value,
                            "الكمية": document.getElementById('quantity').value,
                            "السعر": price + "$"
                        }
                    })
                });
                if(res.ok) alert("✅ تم استلام طلبك");
            } catch (e) { alert("⚠️ فشل الاتصال"); }
            finally { this.disabled = false; }
        };
    }
};
